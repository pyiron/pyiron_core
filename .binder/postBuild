pip install . --no-deps --no-build-isolation

# Save the stuff we actually need for binder
KEEP=(".binder" "demo")
mkdir -p ${HOME}/.temp_keep
for item in "${KEEP[@]}"; do
    [ -e "${HOME}/${item}" ] && mv "${HOME}/${item}" ${HOME}/.temp_keep/
done

# Now clean up everything else
find ${HOME} -mindepth 1 -maxdepth 1 ! -name '.temp_keep' -exec rm -rf {} +

# Restore the kept material
mv ${HOME}/.temp_keep/* ${HOME}/
rmdir ${HOME}/.temp_keep

# setup customized kernel
mkdir -p ${HOME}/.local/share/jupyter/kernels/pyiron_core
cp ${HOME}/.binder/kernel.json ${HOME}/.local/share/jupyter/kernels/pyiron_core

# Bring key content to root
mv ${HOME}/demo/* .

# download datasets for the demos
wget https://github.com/pyiron-workshop/DPG-tutorial-2025/raw/351eeca736cce45f9bc3bfca84ab05de049e38c2/data/mgca.pckl.tgz
wget https://github.com/pyiron-workshop/DPG-tutorial-2025/raw/351eeca736cce45f9bc3bfca84ab05de049e38c2/data/MgCaFreeEnergies.pckl.gz

# Clean up the remaining artifacts of what we kept
rm -rf ${HOME}/.binder ${HOME}/demo
